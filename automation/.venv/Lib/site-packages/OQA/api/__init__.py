from .. import __config
import atexit
from ..utils.jsonHelper import save_as_json_file


global __token
__token=None

global __session
global __data
__session = None
__data = {}


def set_token(token:str):
    global __token
    __token=token


def get_token():
    global __token
    return __token


def __api_teardown():
    global __data
    if __data != {}:
        test_run_folder_path = __config["testFolder"]
        save_as_json_file(__data, "api.json", test_run_folder_path)


def __set_session():
    global __session
    __session=True
    # test_run_folder_path = __config     #getConfig()
    # print("test path", test_run_folder_path)
    # global __data
    # atexit.register(save_as_json_file, __data, filename="api.json", location=test_run_folder_path["testFolder"])
    atexit.register(__api_teardown)


def __create_session():
    global __session
    if not __session:
        __set_session()
    return __session


def data_append(base_url, data):
    global __data
    global __session
    if not __session:
        __create_session()
    
    if base_url not in __data:
        __data[base_url] = []
    __data[base_url].append(data)


__create_session()