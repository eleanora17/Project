import websockets
from . import get_token
from .. import __exe_logger


# global __conn
# __conn=None


'''
global web socket connection object
'''
async def set_ws_connection(url,headers={}, set_token=False):
    if set_token:
        headers["authorization"]=f"Bearer {get_token()}"
    try:
        __conn=await websockets.connect(url,extra_headers=headers)
        return __conn
    except Exception as e:
        __exe_logger.warning(f"Error connecting WebSocket to {url}")
        return None


async def send(__conn, data):
    try:
        await __conn.send(data)
        return await recieve()
    except:
        raise ConnectionError


async def recieve(__conn):
    try:
        return await __conn.recv()
    except:
        raise ConnectionError