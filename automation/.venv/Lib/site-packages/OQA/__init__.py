from .lib import pre_execution, post_execution
import atexit, os
from datetime import datetime, timezone

__config = None
__exe_logger = None
__metaData = {}

def init_config():
    # print("Initializing...")
    print("\033[96mInitializing...\033[0m")

    global __config
    if __config is None:
        __config = pre_execution.getConfig(os.getcwd())

def additional_config():
    pre_execution.init_metadata(__config, __exe_logger)
    pre_execution.init_screenshot_folder(__config)

def init_logger():
    global __config
    global __exe_logger
    __exe_logger = pre_execution.init_execution_logger(__config)        

init_config()
init_logger()
additional_config()

atexit.register(post_execution.setup_report_in_output,__config)
atexit.register(post_execution.dumpDictInOutputFolder)
atexit.register(post_execution.dumpMetaInOutputFolder)