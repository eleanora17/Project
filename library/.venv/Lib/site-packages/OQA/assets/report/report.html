<!DOCTYPE html>
<html lang="en" style="overflow-y: scroll">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Report</title>
    <link rel="shortcut icon" href="https://oqton.com/assets/images/favicon-light-new.png" type="image/png" />
    <style>
      :root {
  --color-bg-primary: #0a2f45;
  --color-bg-secondary: #142834;
  --color-text-light: #fff;
  --color-bg-light: #f4f4f4;
  --color-bg-bright-white: #fff;
  --color-text-dark: #333;
  --color-text-active: darkcyan;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  text-decoration: none;
}


.sidebar {
  /* background-color: var(--color-bg-primary); */
  background: linear-gradient(135deg, var(--color-bg-primary) 30%,  var(--color-bg-secondary));
  position: fixed;
  top: +4.2rem;
  left: 0;
  min-height: calc(100vh - 4.2rem);
  height: 100%;
  min-width: 5rem;
  width: 15%;
  padding: 1rem 2rem;
  color: var(--color-text-light);
  overflow-y: auto;
}

.sidebar-header{
  margin-left: -1rem;
  margin-bottom: 0.5rem;
  text-transform: uppercase;
}

.sidebar-header> div{
  margin-left: 1rem;
  margin-bottom: 0.5rem;
  margin-top: 0.5rem;
  text-transform: capitalize;
}

.sidebar-header> div:hover{
  background-color: var(--color-text-active);
  padding: 0 1rem;
}

.sidebar_active{
  background-color: var(--color-text-active);
  padding: 0 1rem;
}

.sidebar_value {
  width: 100%;
  padding: 0.5rem;
  /* margin: 0.5rem; */
  margin-top: +1rem;
  margin-left: 15%;
  border-radius: 1rem;
   /* Ensures breaking of long words in newer browsers */
}
.sidebar_value > pre{
  white-space: pre-wrap;
  word-wrap: break-word;
}




.content{
  margin-top: 4.2rem;
}


html, body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  background-color: var(--color-bg-bright-white);
  color: var(--color-text-dark);
}

.scroll {
  overflow-y: scroll;
}

.no-scroll {
  overflow-y: hidden;
}

header {
  position: fixed;
  top: 0;
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: var(--color-bg-primary);
  color: var(--color-text-light);
  padding: 1rem 3rem;
}

.col {
  display: flex;
  width: 100%;
}

.row {
  display: flex;
  flex-wrap: wrap;
  animation: fade 1s ease-in-out;
}

.logo {
  width: 6rem;
  fill: var(--color-text-light);
}

nav > ul {
  display: inline-flex;
  list-style: none;
}

nav > ul > li {
  padding: 0 0.5rem;
}

nav > ul > li:hover,
.active {
  color: var(--color-text-active);
  cursor: pointer;
}

.hide {
  display: none;
}

.show {
  display: flex;
}

.card {
  background-color: var(--color-bg-bright-white);
  border-radius: 8px;
  padding: 2rem;
  margin: 1rem;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  transition: box-shadow 0.3s ease-in-out;
}

.card:hover {
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

.chart-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  min-width: fit-content;
}

.donut-chart {
  margin-top: 10px;
}

.legends {
  display: flex;
  flex-direction: column;
}

.legend {
  display: flex;
  align-items: center;
  margin: 5px 0;
}

.legend-color {
  width: 20px;
  height: 20px;
  margin-right: 10px;
  border-radius: 50%;
}

.legend span {
  font-size: 14px;
}

@keyframes fade {
  from {
    opacity: 0;
    transform: translateY(2%);
  }
  to {
    opacity: 100;
    transform: translateY(0);
  }
}

@keyframes opacity {
  from {
    opacity: 0;
  }
  to {
    opacity: 100;
  }
}

@keyframes scale {
  from {
    transform: scale(0);
  }
  to {
    transform: scale(1);
  }
}

table {
  width: 100%;
  border-collapse: collapse;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  background-color: var(--color-bg-light); /* Light background for the table */
  border-radius: 8px;
  overflow: hidden; /* Rounded corners for modern style */
}

table th,
table td {
  padding: 12px 20px;
  text-align: left;
  transition: background-color 0.3s ease, transform 0.3s ease;
  word-wrap: break-word; /* This will break long words to fit in the container */
  overflow-wrap: break-word;
 
}

table th {
  background-color: var(--color-bg-primary);
  color: var(--color-bg-bright-white);
  text-transform: uppercase;
  font-weight: bold;
  letter-spacing: 1px;
}



table td {
  font-size: 16px;
  color: var(--color-text-dark);
  border-top: 1px solid #eee; /* Soft separator lines */
  word-wrap: break-word; /* This will break long words to fit in the container */
  overflow-wrap: anywhere;
  background-color: #fff;
}

table td:first-child {
  font-weight: bold;
}

table th,
table td {
  border-bottom: 1px solid #ddd; /* Soft border under header cells */
}

table th {
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle shadow to give depth */
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.1); /* Light, transparent background */
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
  border-radius: 10px; /* Optional: gives the modal rounded corners */
  /* transition: opacity 1s ease, backdrop-filter 1s ease; Animate opacity and blur */
  animation: opacity 0.5s ease;
}

.blur_effect {
  backdrop-filter: blur(10px) !important;
  -webkit-backdrop-filter: blur(10px) !important;
}

.modal {
  background: white;
  border-radius: 8px;
  padding: 20px;
  position: relative;
  min-width: 400px;
  max-width: 80%;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);

  animation: scale 1s ease;
}

.btn-close-modal {
  position: absolute;
  top: 10px;
  right: 10px;
  background: transparent;
  border: none;
  font-size: 20px;
  cursor: pointer;
}

.modal-content {
  padding: 10px 15px 0px 15px;
}

.form-group {
  margin-bottom: 15px;
}

.form-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
}

.btn-submit {
  background-color: #4caf50;
  color: white;
  border: none;
  padding: 10px 20px;
  cursor: pointer;
}

.btn-close {
  background-color: #f44336;
  color: white;
  border: none;
  padding: 10px 20px;
  cursor: pointer;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  table {
    font-size: 14px; /* Adjust text size for smaller screens */
    padding: 0 10px;
  }

  table th,
  table td {
    padding: 10px 12px;
  }
}

.report > section {
  animation: fade 1s ease-in-out;
  background-color: var(--color-bg-bright-white);
  border-radius: 8px;
}

.screenshots {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  animation: fade 1s ease-in-out;
}

.metadatadetails {
  display: grid;
  grid-template-columns: minmax(auto, 70%) minmax(auto, 30%);
  animation: fade 1s ease-in-out;
  background-color: var(--color-bg-bright-white);
  gap: 1rem;
}

.print-btn {
  background-color: var(--color-bg-primary);
  color: var(--color-text-light);
  padding: 12px 24px;
  font-size: 24px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.3s ease;
  float: right;
  margin: 10px;
}

.print-btn:hover {
  background-color: var(--color-text-active);
  transform: scale(1.05);
}

.print-btn:focus {
  outline: none;
  box-shadow: 0 0 0 4px var(--color-text-active);
}

.print-btn:active {
  background-color: var(--color-text-active);
}

/* Print-specific styles */
@media print {
  body {
    background-color: white;
    color: black;
    margin: 0;
    padding: 0;
  }

  .content {
    margin: 0;
    padding: 0;
  }

  .print-btn {
    display: none;
  }

  .card {
    padding: 2rem;
    margin: 1rem;
    page-break-inside: avoid;
    max-width: 100%;
    min-width: min-content;
  }

  .row {
    flex-direction: column;
    gap: 0.5rem;
  }

  table {
    page-break-before: auto;
    width: 100%;
    background-color: #fff;
  }

  table th,
  table td {
    padding: 8px;
    font-size: 12px;
  }

  table tr {
    page-break-inside: avoid;
    background-color: #fff;
    margin-top: 20px;
  }

  .metadatadetails {
    display: grid;
    grid-template-columns: minmax(auto, 70%) minmax(auto, 30%);
    background-color: var(--color-bg-bright-white);
  }

  #table_testcases {
    page-break-before: always;
  }

  /* Set A4 Landscape size for printing */
  @page {
    size: A4 landscape;
    margin: 20mm;
  }

  /* Force content to fit A4 landscape */
  .content,
  .report {
    width: 100%;
    page-break-before: auto;
  }

  /* Adjust margins for better content fit */
  section {
    margin: 0;
    padding: 1rem;
  }

  header{
    position: unset;
  }
}

    </style>
    <script>
      const baseURL = "http://127.0.0.1:9999/";

async function fetchData(url) {
  try {
    const response = await fetch(baseURL + url, {
      method: "GET",
      headers: { "Cache-Control": "no-store" },
    });

    if (!response.ok) throw new Error("Network response was not ok");

    const url_sections = url.split(".");
    const data = (await (url_sections[url_sections.length - 1].toLowerCase() ==
     "json" || url_sections[url_sections.length - 1].toLowerCase() == "meta"))
      ? response.json()
      : response.text();
    return data;
  } catch (error) {
    console.error("Fetch error:", error);
    return false
  }
}

async function fetchDataFromUrls(urls) {
  const results = {};
  for (let url of urls) {
    results[url] = await fetchData(url);
  }
  return results;
}

// Displays the section corresponding to the selected navigation item and hides the others
function showSection(selectedNavItem, NavItems='nav ul li') {
  const navItems = document.querySelectorAll(NavItems);
  const selectedNavItemLowerCase = selectedNavItem.toLowerCase();

  navItems.forEach((navItem) => {
    const sectionIdFromNavItem = navItem.textContent.trim().toLowerCase();
    const section = document.querySelector(`#${sectionIdFromNavItem}`);

    if (!section) {
      console.error(`${sectionIdFromNavItem} section is not found`);
      return;
    }

    const isActive = sectionIdFromNavItem === selectedNavItemLowerCase;
    section.style.display = isActive ? "block" : "none";
    navItem.classList.toggle("active", isActive);
  });
}

// function to create tables
// data is of type dict, colWidth is list of int values represents size for each columns, if null then take defalut
function create_table(
  data,
  insideElement,
  colWidth = [],
  heading = "",
  showonly = [],
  filter = false
) {
  const mainElement = document.querySelector("#" + insideElement);
  const parentElement = document.createElement("div");
  const filterElement = document.createElement("div");
  filterElement.style.display = "flex";
  filterElement.style.justifyContent = "space-between";
  parentElement.classList.add("card");
  parentElement.style.display = "block";

  if (heading) {
    const div = document.createElement("div");
    const headingElement = document.createElement("h3");

    if (filter) {
      filterElement.style.marginTop = "-15px";
      filterElement.style.marginBottom = "5px";
      headingElement.style.marginTop = "15px";
      headingElement.style.marginBottom = "5px";
    } else {
      headingElement.style.marginTop = "-15px";
      headingElement.style.marginBottom = "5px";
    }

    headingElement.innerText = heading;
    div.appendChild(headingElement);

    if (filter) {
      filterElement.appendChild(div);
      parentElement.appendChild(filterElement);
    } else {
      parentElement.appendChild(div);
    }
  }

  const table = document.createElement("table");

  if (
    Array.isArray(data) &&
    data.length > 0 &&
    typeof data[0] === "object" &&
    !Array.isArray(data[0])
  ) {
    const headerRow = document.createElement("tr");
    const allKeys = new Set();

    const filterOptions = ["All", "Success", "Failed"];

    if (showonly.length > 0) {
      // Gather all unique keys from data (just like you did)
      data.forEach((obj) =>
        Object.keys(obj).forEach((key) => allKeys.add(key))
      );

      const orderedKeys = showonly.filter((key) => allKeys.has(key)); // Filter only existing keys

      allKeys.clear();

      data.forEach((obj) => {
        let orderedObj = {};
        orderedKeys.forEach((key) => {
          if (obj.hasOwnProperty(key)) {
            orderedObj[key] = obj[key];
            allKeys.add(key);
          }
        });
      });
    } else {
      data.forEach((obj) =>
        Object.keys(obj).forEach((key) => allKeys.add(key))
      ); // Gather all unique keys
    }

    const thSrNo = document.createElement("th");
    thSrNo.innerText = "SR NO";
    thSrNo.style.width = "5%";
    headerRow.appendChild(thSrNo);

    Array.from(allKeys).forEach((key, index) => {
      if (showonly.length > 0 && !showonly.includes(key)) return;

      const th = document.createElement("th");
      th.style.textAlign = "center";
      th.innerText = key === "screenshotPath" ? "Screenshots" : key;

      if (colWidth.length > 0) {
        th.style.width = colWidth[index] - Array.from(allKeys).length / 5 + "%";
      }
      headerRow.appendChild(th);
    });

    table.appendChild(headerRow);

    // Create rows with values from each object in the array
    data.forEach((obj, rowIndex) => {
      const row = document.createElement("tr");

      // Add the serial number (SR NO) to the first column
      const tdSrNo = document.createElement("td");
      tdSrNo.innerText = rowIndex + 1; // SR NO starts from 1
      row.appendChild(tdSrNo);

      Array.from(allKeys).forEach((key) => {
        if (showonly.length > 0 && !showonly.includes(key)) return;

        const td = document.createElement("td");

        if (key === "screenshotPath") {
          const file = obj[key].split("\\");
          const img = document.createElement("img");
          img.src = baseURL + "" + file[file.length - 1];
          img.alt = obj[key];
          img.width = 250;
          img.onclick = function () {
            const div = document.createElement("div");
            const img1 = document.createElement("img");
            img1.src = baseURL + "" + file[file.length - 1];
            img1.alt = obj[key];
            img1.style.width = "100%";

            div.appendChild(img1);

            if ("title" in obj) {
              const span1 = document.createElement("span");
              const span2 = document.createElement("span");

              var flag = false;
              if ("status" in obj) {
                if ("Success" == obj.status) {
                  flag = true;
                  span2.style.color = "rgb(76, 175, 80)";
                  span2.innerHTML = " &#10004;";
                }
                if ("status" in obj && "Assertion Failed" == obj.status) {
                  flag = true;
                  span2.style.color = "rgb(244 67 51)";
                  span2.innerHTML = " &#10008;";
                }
              }

              span1.innerHTML = obj["title"];
              span1.style.textAlign = "center";
              span1.style.display = "block";

              span1.appendChild(span2);
              div.appendChild(span1);
            }
            modelToggle("model", div);
          };
          td.appendChild(img);
        } else {
          // const span = document.createElement("span");
          // span.style.fontSize = "2rem";
          // span.style.textAlign = "center";
          // span.style.width = "100%";

          if ("status" in obj && "Success" == obj.status && key == "status") {
            td.style.fontSize = "2rem";
            td.style.textAlign = "center";
            td.style.color = "rgb(76, 175, 80)";
            td.innerHTML = " &#10004;";
            row.classList.add("pass");
          } 
          else if ( "status" in obj && "Assertion Failed" == obj.status && key == "status" ) {
            td.style.fontSize = "2rem";
            td.style.textAlign = "center";
            td.style.color = "rgb(244 67 51)";
            td.innerHTML = " &#10008;";
            row.classList.add("failed");
          } 
          else if (key.toLowerCase() == "title") {
            const div = document.createElement("div");
            div.style.fontWeight="600"
            div.innerText=obj[key]
            td.appendChild(div)

            if ('remark' in obj && obj['remark'] != ""){
              const samp = document.createElement("samp");
              samp.style.fontStyle = "italic"; 
              samp.style.color='grey'

              const strong = document.createElement("strong");
              const span2 = document.createElement("span");

              strong.innerText="Remark : "
              span2.innerText=obj['remark']
              samp.appendChild(strong)
              samp.appendChild(span2)
              td.appendChild(samp)
            }
            
          } 
          else {
            const value = obj[key];
            td.innerText =
              value === null || value === undefined ? "N/A" : value; // Handle null and undefined values gracefully
          }

          if (key === "status" && !filterOptions.includes(obj[key])) {
            if (obj[key]=="Assertion Failed"){
              if(!filterOptions.includes('Failed')){
                filterOptions.push['Failed']
              }
            }
            else{
              filterOptions.push(obj[key]);
            }
            // console.log(obj[key])
          }
        }
        row.appendChild(td);
      });
      table.appendChild(row);
    });
    const optionDiv = document.createElement("div");
    optionDiv.textContent = "Filter By : ";
    optionDiv.id = "filterby";
    // console.log(filterOptions)
    filterOptions.forEach((key, i) => {
      const button = document.createElement("button");
      const value = key == "Assertion Failed" ? "Failed" : key;
      button.textContent = value;
      button.id = value;

      // Add inline styles
      if (key == "All") {
        button.style.backgroundColor = "#0a2f45"; // Green background
        button.style.opacity = 1;
      } else {
        button.style.backgroundColor = "#142834";
        button.style.opacity = 0.5;
      }
      button.style.color = "white"; // White text
      button.style.border = "none"; // Remove border
      button.style.padding = "10px 20px"; // Padding
      button.style.margin = "5px"; // Space between buttons
      button.style.cursor = "pointer"; // Pointer cursor on hover
      button.style.borderRadius = "5px"; // Rounded corners
      button.style.fontSize = "16px"; // Font size

      button.addEventListener("click", () => filterFun(insideElement, value));
      optionDiv.appendChild(button);
    });

    filterElement.appendChild(optionDiv);
  } else {
    // Create data rows for other format
    let flag = false;
    Object.entries(data).forEach((obj, index) => {
      const row = document.createElement("tr");
      flag = false;
      Object.entries(obj).forEach(([key, value], i) => {
        // Ensure both value and showonly are trimmed before comparison
        if (i === 0) {
          if (showonly.length > 0 && !showonly.includes(value)) return;
          flag = true;
        }
        if (flag) {
          const td = document.createElement("td");
          const th = document.createElement("th");

          // Handle null or undefined values by replacing them with "N/A"
          const displayValue =
            value === null || value === undefined ? "N/A" : value;

          // Assign value to th or td based on the index
          if (i === 0) {
            th.innerText = displayValue;
            if (colWidth.length > 0) {
              th.style.width = colWidth[i] + "%";
            }
            row.appendChild(th);
          } else {
            td.innerText = displayValue;
            if (colWidth.length > 0) {
              td.style.width = colWidth[i] + "%";
            }
            row.appendChild(td);
          }
        }
      });

      if (flag) {
        table.appendChild(row);
      }
    });
  }

  parentElement.appendChild(table);
  mainElement.appendChild(parentElement);
}

function filterFun(parent = "body", key = "All") {
  const parentElement = document.querySelector("#" + parent);
  const success = parentElement.querySelectorAll(".pass");
  const failed = parentElement.querySelectorAll(".failed");

  const allBtn = document.querySelector("#All");
  const successBtn = document.querySelector("#Success");
  const failedBtn = document.querySelector("#Failed");

  if (key === "Success") {
    // console.log(success);
    success.forEach((item) => (item.style.display = ""));
    failed.forEach((item) => (item.style.display = "none"));

    successBtn.style.backgroundColor = "#0a2f45"; // Green background
    successBtn.style.opacity = 1;

    allBtn.style.opacity = 0.5;
    failedBtn.style.opacity = 0.5;
  } else if (key === "Failed") {
    // console.log(failed);
    success.forEach((item) => (item.style.display = "none"));
    failed.forEach((item) => (item.style.display = ""));

    failedBtn.style.backgroundColor = "#0a2f45"; // Green background
    failedBtn.style.opacity = 1;

    allBtn.style.opacity = 0.5;
    successBtn.style.opacity = 0.5;
  } else if (key === "All") {
    success.forEach((item) => (item.style.display = ""));
    failed.forEach((item) => (item.style.display = ""));

    allBtn.style.backgroundColor = "#0a2f45"; // Green background
    allBtn.style.opacity = 1;

    failedBtn.style.opacity = 0.5;
    successBtn.style.opacity = 0.5;
  }
}

// donut
function createDonutChart(
  data,
  elementId,
  Heading = "",
  showPercentage = false
) {
  const mainElement = document.querySelector("#" + elementId);
  const parentElement = document.createElement("div");
  parentElement.classList.add("card");

  // Create chart container
  const chartContainer = document.createElement("div");
  chartContainer.classList.add("chart-container");

  if (Heading) {
    const headingElement = document.createElement("h3"); // or any other tag you prefer
    headingElement.textContent = Heading;
    headingElement.style.marginTop="-2rem"
    chartContainer.appendChild(headingElement); // Append heading above chart
  }

  // Create legends container
  const legends = document.createElement("div");
  legends.classList.add("legends");

  // Create donut chart container
  const donutChart = document.createElement("div");
  donutChart.classList.add("donut-chart");

  // Create SVG element for donut chart
  const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  svg.setAttribute("viewBox", "0 0 200 200");
  svg.setAttribute("width", "200");
  svg.setAttribute("height", "200");

  // Calculate the total sum of all values in data
  const total = Object.values(data).reduce((a, b) => a + b, 0);

  // Define radius and circumference of the donut chart
  const radius = 80;
  const circumference = 2 * Math.PI * radius; // Full circumference of the circle

  // Calculate the stroke-dasharray values for each segment
  const strokeDashArray = Object.values(data).map(
    (val) => (val / total) * circumference
  );

  // Define the colors for each section (adjust or generate dynamically as needed)
  const colors = [
    "#4caf50",
    "#f44336",
    "#ff9800",
    "#2196f3",
    "#9c27b0",
    "#8e44ad",
    "#2ecc71",
    "#e67e22",
  ];

  // Ensure the number of colors matches the number of data categories
  const dynamicColors = colors.slice(0, Object.keys(data).length);

  let offset = 0; // Starting offset for the first circle
  let index = 0; // Color index to cycle through the colors

  // Create a circle for each data point
  Object.entries(data).forEach(([category, value]) => {
    const circle = document.createElementNS(
      "http://www.w3.org/2000/svg",
      "circle"
    );

    circle.setAttribute("cx", 100); // Center x-coordinate
    circle.setAttribute("cy", 100); // Center y-coordinate
    circle.setAttribute("r", radius); // Radius of the circle
    circle.setAttribute("fill", "none"); // No fill
    circle.setAttribute("stroke-width", "30"); // Stroke width

    // Set the stroke color based on the dynamic color array
    circle.setAttribute("stroke", dynamicColors[index]);

    // Set stroke-dasharray and stroke-dashoffset to create the donut effect
    const dashArray = strokeDashArray[index];
    circle.setAttribute(
      "stroke-dasharray",
      `${dashArray} ${circumference - dashArray}`
    );
    circle.setAttribute("stroke-dashoffset", -offset);

    // Append the circle to the SVG element
    svg.appendChild(circle);

    // Update the offset for the next circle
    offset += dashArray;
    index++;
  });

  // Create legends dynamically based on the data
  let total_items = 0;
  Object.entries(data).forEach(([category, value], legendIndex) => {
    total_items += value;
    const legend = document.createElement("div");
    legend.classList.add("legend");

    const colorDiv = document.createElement("div");
    colorDiv.classList.add("legend-color");
    colorDiv.style.backgroundColor = dynamicColors[legendIndex];
    legend.appendChild(colorDiv);

    const label = document.createElement("span");
    label.textContent = showPercentage
      ? `${category} (${Math.round((value / total) * 100)}%)`
      : `${category} (${value})`;
    legend.appendChild(label);
    legends.appendChild(legend);
  });

  // Add total count text inside the SVG (remaining code)
  const total_text = document.createElementNS(
    "http://www.w3.org/2000/svg",
    "text"
  );
  total_text.setAttribute("x", "50%");
  total_text.setAttribute("y", "60%");
  total_text.setAttribute("text-anchor", "middle");
  total_text.setAttribute("dominant-baseline", "middle");
  total_text.setAttribute("font-size", "16");
  total_text.setAttribute("fill", "#000");
  total_text.textContent = "Total";
  svg.appendChild(total_text);

  const total_actual_items = document.createElementNS(
    "http://www.w3.org/2000/svg",
    "text"
  );
  total_actual_items.setAttribute("x", "50%");
  total_actual_items.setAttribute("y", "50%");
  total_actual_items.setAttribute("text-anchor", "middle");
  total_actual_items.setAttribute("dominant-baseline", "middle");
  total_actual_items.setAttribute("font-size", "30");
  total_actual_items.setAttribute("fill", "#000");
  total_actual_items.textContent = total_items;
  svg.appendChild(total_actual_items);

  // Append SVG and legends to donut chart container
  donutChart.appendChild(svg);

  // Append donut chart and legends to chart container
  chartContainer.appendChild(donutChart);
  chartContainer.appendChild(legends);

  // Append the chart container to the parent element
  parentElement.appendChild(chartContainer);
  mainElement.appendChild(parentElement);
}

// pie chart
function createPieChart(data, elementId, centerText = "") {
  const parentElement = document.querySelector("#" + elementId);

  // Create chart container
  const chartContainer = document.createElement("div");
  chartContainer.classList.add("chart-container");

  // Create legends container
  const legends = document.createElement("div");
  legends.classList.add("legends");

  // Create pie chart container
  const pieChart = document.createElement("div");
  pieChart.classList.add("pie-chart");

  // Create SVG element for pie chart
  const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  svg.setAttribute("viewBox", "0 0 200 200");
  svg.setAttribute("width", "200");
  svg.setAttribute("height", "200");

  // Calculate the total sum of all values in data
  const total = Object.values(data).reduce((a, b) => a + b, 0);

  // Define radius and circumference of the pie chart
  const radius = 80;
  const circumference = 2 * Math.PI * radius; // Full circumference of the circle

  // Calculate the stroke-dasharray values for each segment (this is the same for pie chart)
  const strokeDashArray = Object.values(data).map(
    (val) => (val / total) * circumference
  );

  // Define the colors for each section (adjust or generate dynamically as needed)
  const colors = [
    "#4caf50",
    "#f44336",
    "#ff9800",
    "#2196f3",
    "#9c27b0",
    "#8e44ad",
    "#2ecc71",
    "#e67e22",
  ];

  // Ensure the number of colors matches the number of data categories
  const dynamicColors = colors.slice(0, Object.keys(data).length);

  let offset = 0; // Starting offset for the first circle
  let index = 0; // Color index to cycle through the colors

  // Create a circle for each data point (for pie, we use arc segments instead of full circles)
  Object.entries(data).forEach(([category, value]) => {
    const segment = document.createElementNS(
      "http://www.w3.org/2000/svg",
      "path"
    );

    // Compute the angle and position of each segment
    const startAngle = (offset / circumference) * 2 * Math.PI;
    const endAngle =
      ((offset + strokeDashArray[index]) / circumference) * 2 * Math.PI;

    const x1 = 100 + radius * Math.cos(startAngle);
    const y1 = 100 + radius * Math.sin(startAngle);
    const x2 = 100 + radius * Math.cos(endAngle);
    const y2 = 100 + radius * Math.sin(endAngle);

    const largeArcFlag = strokeDashArray[index] > circumference / 2 ? 1 : 0;

    // Create a path representing the segment
    const pathData = [
      "M",
      100,
      100,
      "L",
      x1,
      y1,
      "A",
      radius,
      radius,
      0,
      largeArcFlag,
      1,
      x2,
      y2,
      "Z",
    ].join(" ");

    segment.setAttribute("d", pathData);
    segment.setAttribute("fill", dynamicColors[index]);

    // Append the segment path to the SVG element
    svg.appendChild(segment);

    // Update the offset for the next segment
    offset += strokeDashArray[index];
    index++;
  });

  // Add text in the center (optional)
  if (centerText) {
    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
    text.setAttribute("x", "50%");
    text.setAttribute("y", "50%");
    text.setAttribute("text-anchor", "middle");
    text.setAttribute("dominant-baseline", "middle");
    text.setAttribute("font-size", "16");
    text.setAttribute("fill", "#000");
    text.textContent = centerText; // Add the desired text here
    svg.appendChild(text);
  }

  // Create legends dynamically based on the data
  Object.entries(data).forEach(([category, value], legendIndex) => {
    const legend = document.createElement("div");
    legend.classList.add("legend");

    const colorDiv = document.createElement("div");
    colorDiv.classList.add("legend-color");
    colorDiv.style.backgroundColor = dynamicColors[legendIndex]; // Match the color of the segment
    legend.appendChild(colorDiv);

    const label = document.createElement("span");
    label.textContent = `${category} (${Math.round((value / total) * 100)}%)`; // Display percentage
    legend.appendChild(label);
    legends.appendChild(legend);
  });

  // Append SVG and legends to pie chart container
  pieChart.appendChild(svg);

  // Append pie chart and legends to chart container
  chartContainer.appendChild(pieChart);
  chartContainer.appendChild(legends);

  // Append the chart container to the parent element
  parentElement.appendChild(chartContainer);
}

function modelToggle(elementId, element1 = null) {
  const element = document.querySelector("#" + elementId);
  const modalContent = element.querySelector(".modal-content");

  if (element1) {
    if (element1 instanceof HTMLElement) {
      const modalImage = element1.cloneNode(true);
      modalImage.style.width = "100%"; // Ensures it fits inside the modal container
      modalImage.style.height = "auto";
      modalContent.innerHTML = "";
      modalContent.appendChild(modalImage);
    } else {
      modalContent.innerHTML = element1;
    }
  }

  if (element.style.display == "none") {
    element.classList.add("blur_effect");
    element.style.display = "flex";
  } else {
    setTimeout(function () {
      element.classList.remove("blur_effect");
    }, 1000);
    element.style.display = "none";
    modalContent.innerHTML = "";
  }
}

function closeModal(event, force = false) {
  const modalOverlay = document.querySelector(".modal-overlay");

  if (event.target === modalOverlay) {
    modalOverlay.style.display = "none"; // Hide the modal
    printwindow(false);
  }

  if (force) {
    modalOverlay.style.display = "none"; // Hide the modal
    printwindow(false);
  }
}

function handleSubmit(event) {
  event.preventDefault();
  const name = document.querySelector("#name");
  const comment = document.querySelector("#comment");
  const qa_info = {};

  if (name.value.trim()) {
    qa_info["Name"] = name.value.trim();
  }

  if (comment.value.trim()) {
    qa_info["Comment"] = comment.value.trim();
  }

  if (Object.keys(qa_info).length > 0) {
    document.querySelector("#table_qa").innerHTML = "";
    create_table(qa_info, "table_qa", [30, 70], "Verified By QA");
  }

  modelToggle("model");
  window.print();

  window.onafterprint = function () {
    printwindow(false);
  };
}

function printwindow(flag = true) {
  const selected = document.querySelector(".active");
  const navItems = document.querySelectorAll("nav ul li");

  const formHTML = `
  <form id="commentForm" style="font-family: Arial, sans-serif; margin: 20px; max-width: 400px; margin: 0 auto;">
  <h3 style="text-align: center; font-size: 24px; margin-bottom: 20px;">Verified By</h3>

  <div style="margin-bottom: 20px;">
    <label for="name" style="font-weight: bold; display: block; margin-bottom: 8px;">Name:</label>
    <input type="text" id="name" name="name" required 
      style="padding: 10px; font-size: 16px; width: 100%; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
  </div>
  
  <div style="margin-bottom: 20px;">
    <label for="comment" style="font-weight: bold; display: block; margin-bottom: 8px;">Comment:</label>
    <textarea id="comment" name="comment" rows="5" required 
      style="padding: 10px; font-size: 16px; width: 100%; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; resize: vertical;"></textarea>
  </div>
  
  <div>
    <button type="button" onclick="handleSubmit(event)" 
      style="background-color: #0a2f45; color: white; padding: 14px 28px; font-size: 16px; border: none; cursor: pointer; border-radius: 8px; width: 100%; transition: background-color 0.3s;">
      Print
    </button>
  </div>
</form>
`;

  navItems.forEach((item) => {
    const section = item.textContent.trim().toLowerCase();
    if (flag) {
      if (selected.textContent.toLocaleLowerCase() != section) {
        item.style.display = "None";
      } else {
        modelToggle("model", formHTML);

        item.style.color = "white";
        item.style.letterSpacing = "1px";
        item.style.textTransform = "uppercase";
        item.style.fontWeight = "bold";
      }
    } else {
      if (selected.textContent.toLocaleLowerCase() != section) {
        item.style.display = "block";
      } else {
        item.style.color = "";
        item.style.letterSpacing = "";
        item.style.textTransform = "";
        item.style.fontWeight = "";
      }
    }
  });

  const filter = document.querySelector("#filterby");
  if (flag) {
    filter.style.display = "none";
  } else {
    filter.style.display = "block";
  }
}

// gallery
function create_gallery(img_srcs, parentID) {
  const parent = document.querySelector("#" + parentID);
  const parentDiv = document.createElement("div");
  parentDiv.classList.add("screenshots");
  // Style the parent container
  Object.assign(parent.style, {
    display: "none",
  });

  img_srcs.forEach((src, index) => {
    const img = document.createElement("img");
    img.src = baseURL + src; // Assuming image paths are correct
    img.width = 250; // Set width for uniform image size
    img.alt = "Gallery Image"; // For better accessibility
    img.style.cursor = "pointer"; // Make image clickable
    img.style.transition = "transform 0.3s ease"; // Smooth hover effect

    // Add shadow and spacing around the image
    Object.assign(img.style, {
      padding: "0.6rem",
      margin: "0.5rem",
      boxShadow: "0 4px 8px rgba(0,0,0,0.1)",
    });

    // Add event listener to open in model view when clicked
    img.addEventListener("click", () => modelToggle("model", img));

    parentDiv.appendChild(img);
  });
  parent.appendChild(parentDiv);
}

function show_logs(data, parentId) {
  const parent = document.querySelector("#" + parentId);
  const main = document.createElement('div')
  main.style.display='flex'

  const sidebar = document.createElement('div')
  sidebar.classList.add("sidebar")

  const header = document.createElement('div');
  header.classList.add('sidebar-header');
  header.innerText = "Logs";
  sidebar.appendChild(header);

  const sidebar_content = document.createElement('div')
  sidebar_content.classList.add("sidebar_value")

  const show = function (key, all_Items) {
    // console.log(key,all_Items)
    const log = document.querySelectorAll(all_Items)
    const search = document.querySelector(key)

    log.forEach(element => {
      // console.log(element.id, key.slice(1))

      const element_heading = document.querySelector('[data="'+element.id+'"]');

      if (element.id==key.slice(1)){
        element.style.display=''
        // console.log(element_heading,'[data="'+key.slice(1)+'"]')
        element_heading.classList.add("sidebar_active")
        // console.log(true)
      }else{
        element.style.display='none'
        element_heading.classList.remove("sidebar_active")
      }
      
    });
  }

  Object.entries(data).forEach(([key,value], i)=>{
    const div = document.createElement("div")
    div.innerText=key
    div.setAttribute('data','log'+i)

    const valueContent = document.createElement('pre');
    valueContent.textContent=value
    valueContent.style.display='none'
    valueContent.id='log'+i
    valueContent.classList.add("log")

    sidebar_content.appendChild(valueContent)

    div.onclick = function() {
      show('#log' + i, '.log');
    }

    header.appendChild(div)
  })

  main.appendChild(sidebar)
  main.appendChild(sidebar_content)

  parent.appendChild(main)
  show('#log0' , '.log'); 

}


    </script>
    <script></script>
  </head>
  <body>
    <header>
      <div class="logo">
        <svg preserveAspectRatio="xMidYMid meet" viewBox="0 0 82 16">
          <g>
            <path
              d="M8,16 C3.581722,16 5.41083001e-16,12.418278 0,8 C-5.41083001e-16,3.581722 3.581722,8.11624501e-16 8,0 C12.418278,-8.11624501e-16 16,3.581722 16,8 C15.9945749,12.4160289 12.4160289,15.9945749 8,16 Z M8,3.69230769 C5.62092723,3.69230769 3.69230769,5.62092723 3.69230769,8 C3.69230769,10.3790728 5.62092723,12.3076923 8,12.3076923 C10.3790728,12.3076923 12.3076923,10.3790728 12.3076923,8 C12.3076923,6.85752897 11.8538475,5.76185057 11.0459984,4.95400156 C10.2381494,4.14615254 9.14247103,3.69230769 8,3.69230769 Z"
            ></path>
            <path
              d="M57.5238095,16 C53.1055315,16 49.5238095,12.418278 49.5238095,8 C49.5238095,3.581722 53.1055315,8.11624501e-16 57.5238095,0 C61.9420875,-8.11624501e-16 65.5238095,3.581722 65.5238095,8 C65.5183844,12.4160289 61.9398384,15.9945749 57.5238095,16 Z M57.5238095,3.69230769 C55.1447368,3.69230769 53.2161172,5.62092723 53.2161172,8 C53.2161172,10.3790728 55.1447368,12.3076923 57.5238095,12.3076923 C59.9028823,12.3076923 61.8315018,10.3790728 61.8315018,8 C61.8315018,6.85752897 61.377657,5.76185057 60.569808,4.95400156 C59.761959,4.14615254 58.6662806,3.69230769 57.5238095,3.69230769 Z"
            ></path>
            <path
              d="M25.2885763,12.3088313 C22.5331899,12.3088313 20.3938257,9.5441476 21.3369606,6.56537626 C21.7358008,5.31877019 22.6845921,4.34093337 23.8941693,3.92988341 C26.7844599,2.95787624 29.467022,5.16273301 29.467022,8.00247041 C29.467022,9.45063805 28.932181,10.7339336 27.8732435,11.5152305 C27.8631221,11.5230333 27.8588673,11.5365607 27.8626221,11.5489993 C27.8663769,11.5614379 27.8773271,11.5700901 27.8899572,11.570598 L32.2725499,11.570598 C32.3089367,11.5711544 32.3423879,11.5500862 32.3585065,11.5164609 C32.8611138,10.4546353 33.0485469,9.26238856 33.0485469,8.00247041 C33.0448743,5.54703959 31.9492907,3.22882901 30.075703,1.71205288 C28.2021152,0.195276758 25.7572842,-0.352680237 23.4417033,0.225182662 C20.6128487,0.907180698 18.4040435,3.18360429 17.7423034,6.0990589 C17.1816052,8.48552685 17.7132858,11.0052018 19.185008,12.9361459 C20.6567301,14.8670899 22.9060811,15.9962127 25.2885763,15.9999978 L34.9694381,15.9999978 C34.9945831,16.0001917 35.0182606,15.9878164 35.0329658,15.9667944 C35.0476711,15.9457723 35.051581,15.9187098 35.0434563,15.8941843 L33.9116944,12.3924977 C33.8954119,12.34281 33.850359,12.3092208 33.7994733,12.3088313 L25.2885763,12.3088313 Z"
            ></path>
            <path
              d="M48,0.124031008 C48,0.0555305737 47.9452927,0 47.8778077,0 L35.1698113,0 C35.1023264,0 35.047619,0.0555305737 35.047619,0.124031008 L35.047619,4.09302326 C35.047619,4.16152369 35.1023264,4.21705426 35.1698113,4.21705426 L39.3243486,4.21705426 C39.3918335,4.21705426 39.4465409,4.27258484 39.4465409,4.34108527 L39.4465409,15.875969 C39.4465409,15.9444694 39.5012482,16 39.5687332,16 L43.4788859,16 C43.5463708,16 43.6010782,15.9444694 43.6010782,15.875969 L43.6010782,4.34108527 C43.6010782,4.27258484 43.6557855,4.21705426 43.7232704,4.21705426 L47.8778077,4.21705426 C47.9452927,4.21705426 48,4.16152369 48,4.09302326 L48,0.124031008 Z"
            ></path>
            <path
              d="M81.283208,16 L81.4035088,16 C81.469949,16 81.5238095,15.9444694 81.5238095,15.875969 L81.5238095,0.124031009 C81.5238095,0.0555305751 81.469949,1.44799766e-09 81.4035088,1.44799766e-09 L77.7944862,1.44799766e-09 C77.7280459,1.44799766e-09 77.6741855,0.0555305751 77.6741855,0.124031009 L77.6741855,7.9379845 C77.6746121,7.96195236 77.6613338,7.98393967 77.6402842,7.99412102 C77.6192345,8.00430237 77.5943465,8.00077544 77.5767419,7.98511628 L68.2702757,0.0831007766 C68.2059747,0.0293326557 68.1256983,-7.5258453e-06 68.0429073,1.44799764e-09 L67.9298246,1.44799764e-09 C67.8633843,1.44799764e-09 67.8095238,0.0555305751 67.8095238,0.124031009 L67.8095238,15.875969 C67.8095238,15.9444694 67.8633843,16 67.9298246,16 L71.5388471,16 C71.6052874,16 71.6591479,15.9444694 71.6591479,15.875969 L71.6591479,8.31007752 C71.658788,8.28613326 71.6718317,8.26411506 71.6926576,8.25351174 C71.7134836,8.24290842 71.7383698,8.24561502 71.7565915,8.26046512 L81.0642607,15.9168992 C81.1265733,15.9683425 81.2034167,15.9975082 81.283208,16 Z"
            ></path>
          </g>
        </svg>
      </div>
      <div>
        <nav>
          <ul id="navbar">
            <!-- <li onclick="showSection('Report')">Report</li>
            <li onclick="showSection('Screenshots')">Screenshots</li>
            <li onclick="showSection('screenrecording')">ScreenRecording</li>
            <li onclick="showSection('Logs')">Logs</li> -->
          </ul>
        </nav>
      </div>
      <div>
        <span>QA Automation Library</span>
        <div>
          <span>Version:</span>
          <span id="version"></span>
        </div>
      </div>
    </header>

    <div class="content" id="containt">
      <div
        id="model"
        class="modal-overlay"
        style="display: none"
        onclick="closeModal(event)"
      >
        <div class="modal">
          <button class="btn-close-modal" onclick="closeModal(event, true)">
            X
          </button>
          <div class="modal-content" id="modal-content">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>
      </div>

      <div class="report" id="report">
        <section>
          <div class="metadatadetails">
            <div>
              <div id="table_metadata"></div>
              <div id="table_envdata"></div>
              <div id="table_qa"></div>
            </div>
            <div>
              <button onclick="printwindow()" class="print-btn">
                &#128438;
              </button>
              <div id="chartContainer"></div>
              <div id="time_duration"></div>
            </div>
          </div>
        </section>

        <section
          style="display: flex; justify-content: center; align-items: center"
        ></section>

        <section class="">
          <div id="table_testcases"></div>
        </section>
      </div>

      <section>
        <div  id="screenshots">
      </section>

      </div>

      
      <div class="logs" id="logs"></div>

      <section>
        <div id="screenrecording" >
          <div style="display: flex; justify-content: center; align-items: center; width: 99vw; height: calc(100vh - 4.2rem); top: 4.2rem;" >
            <video style="width: 90%; height: 90%; border-radius: 4px;" controls>
              <source src="screenRec.mp4" type="video/mp4">
          </video>
          
          </div>
        </div>
        
      </section>
      
    </div>

    <script>
      const screenshots = []
      let loadData;
      const links = ['Report', 'Screenshots', 'Screenrecording','Logs']


      function main() {
        // calling all apis or fetching all data
        const urls = [
          "assertions_json.json",
          ".meta",
          "assertions.log",
          "execution.log",
          "browser_logs.log",
          "dictDump.json"
        ];
        
        fetchDataFromUrls(urls)
          .then((data) => {
            loadData = data;
            try {
              const timestamp = new Date (loadData[".meta"]?.main?.timestamp).toLocaleString()
              loadData['.meta'].main.timestamp = timestamp
            } catch (error) {
              console.error("Unable to localize date ", loadData['.meta']?.main?.timestamp)
            }
            
            const meta = {
              ...loadData[".meta"]?.main,
              ...loadData[".meta"]?.browser,
              ...loadData[".meta"]?.tanent,
            };

            document.querySelector("#version").textContent =
              meta?.["QA Automation Library, Version"] ?? "undefined";
            // Meta
            create_table(meta, "table_metadata", [], "Meta Data", [
              "testScript",
              "testFolder",
              "timestamp",
            ]);
            create_table(meta, "table_envdata", [], "Environment Data", [
              "browserName",
              "browserVersion",
              "platformName",
              "url",
            ]);

            
            try {
              create_table(
              loadData["assertions_json.json"],
              "table_testcases",
              [80,10, 10],
              "Test Cases",
              ["title",  "screenshotPath", "status"],
              true
              );

             // assertions
           
             const assertions = { Pass: 0, Failed: 0 };
            loadData["assertions_json.json"].forEach((element) => {
              if (element?.["status"] === "Success") {
                assertions["Pass"]++;
              } else if (element?.["status"] === "Assertion Failed") {
                assertions["Failed"]++;
              }
            });

            createDonutChart(
              assertions,
              "chartContainer",
              (Heading = "Assertions"),
            );

            } catch (error) { 
              console.error(error)
            }
           

            try {
              const start = new Date (loadData[".meta"]?.execution?.start).toLocaleString()
              const end = new Date (loadData[".meta"]?.execution?.end).toLocaleString()

              const metaNew = {
              "Started": start,
              "Ended": end,
              "Duration": loadData[".meta"]?.execution?.duration,
            }
              create_table(
              metaNew,
              "time_duration",
              [30,70],
              "Test Execution",              
            );
            } catch (error) {
              console.error(error)
            }
           

            const logs = {
              "Execution":loadData["execution.log"],
              "Assertions":loadData["assertions.log"],
              "Browser logs":loadData["browser_logs.log"]
            }

            show_logs(logs, "logs")
            showNav()
          })
          .catch((error) => console.error("Error fetching data:", error));


        // showSection("Screenshots");
        
        fetchData("screenshots/")
          .then((html) => {
            let parser = new DOMParser();
            let doc = parser.parseFromString(html, "text/html");
            let listItems = doc.querySelectorAll("li"); // Adjust the selector if needed

            listItems.forEach((item) => {
              screenshots.push("screenshots/"+item.textContent)
            });

            create_gallery(screenshots,"screenshots")
            showNav()


          })
          .catch((error) => {
            console.error("Error fetching or parsing the HTML:", error);
          });
      }


      main();
      showNav()
      // showSection("Report");
      
      async function showNav(){
        const list = document.querySelector("#navbar")
        list.innerHTML=''
        links.forEach(element => {
          
          if (element=="Screenshots" && screenshots.length<=0) {
            return
          } else if (element=="Screenrecording") {
            const video = fetchData("screenRec.mp4")
            video.then(flag =>{
              if (!flag && links.includes("Screenrecording")){
                const index = links.indexOf("Screenrecording");
                  links.splice(index, 1); // Removes the element at the found index
                return
              }
            })
          }

          const li = document.createElement('li')
          li.onclick = function(){
            showSection(element)
          }
        
          li.textContent=element
          list.appendChild(li)
          
        
        });
        showSection(links[0])
      }
            
    </script>
  </body>
</html>
