import shutil, os
from ..utils import utils, jsonHelper
from importlib.resources import files
from . import metadata_helper
from datetime import datetime, timezone


def setup_report_in_output(config):
    test_op_dir = config["testFolder"] + "/"
    test_op_dir = utils.normalize_path(test_op_dir)
    src = files('OQA').joinpath("assets").joinpath("report")
    # src = utils.normalize_path(src)
    # print(src)
    
    ignored_dirs = ['System Volume Information', '$Recycle.Bin', 'Windows', 'Program Files', 'Program Files (x86)',
                    'AppData', 'Temp', '/proc', '/sys', '/dev', '/run', '/var/lib', '/var/run', '/var/cache', '/tmp',
                    '/mnt', '/media']
    
    for dirpath, dirnames, filenames in os.walk(src):
        dirnames[:] = [d for d in dirnames if d not in ignored_dirs]
        for filename in filenames:
            filePath = os.path.join(dirpath, filename)
            shutil.copy(filePath, test_op_dir)


def dumpDictInOutputFolder():
    data = utils.getDictionary()
    if data != {} and data != None:
        jsonHelper.save_as_json_file(data,"dictDump.json")

def dumpMetaInOutputFolder():
    metadata = metadata_helper.get_metadata()
    if metadata != {} and metadata != None:
        jsonHelper.save_as_json_file(metadata,".meta")
